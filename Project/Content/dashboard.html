  <!DOCTYPE html>
  <html lang="en">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FurFect Match - Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
  :root {
    --bg: #fffbe9;
    --sidebar: #f7d79e;
    --highlight: #f78c56;
    --card-bg: #d2c5f5;
    --pet-card: #b8f2a5;
    font-family: 'Poppins', sans-serif;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    display: flex;
    min-height: 100vh;
    background: var(--bg);
    color: #111114;
    transition: all 0.3s ease;
  }

  .sidebar {
    background: var(--sidebar);
    width: 220px;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    transition: all 0.3s ease;
  }

  .profile-wrapper {
    position: relative;
    width: 90px;
    height: 90px;
    margin-bottom: 10px;
  }

  .profile-wrapper img {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #333;
  }

  .upload-btn {
    position: absolute;
    bottom: 0;
    right: 0;
    background: var(--highlight);
    color: white;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    border: 2px solid #fff;
  }

  #profileInput { display: none; }

  .username {
    font-weight: 600;
    margin-bottom: 20px;
    text-align: center;
  }

  .menu { width: 100%; flex-grow: 1; }

  .menu a {
    display: block;
    padding: 10px;
    text-decoration: none;
    color: #111114;
    font-weight: 500;
    border-bottom: 1px solid black;
  }

  .menu a.active {
    color: var(--highlight);
    font-weight: 600;
  }

  .logout-btn {
    display: block;
    width: 100%;
    padding: 10px;
    margin-top: 10px; 
    text-align: center;
    text-decoration: none;
    color: #111114;
    background: #f78c56;
    border-radius: 8px;
    font-weight: 600;
  }

  .logout-btn:hover {
    background: #f55c2b;
    color: white;
  }

  .topbar {
    background: #c5b7e9;
    display: flex;
    justify-content: flex-start;
    align-items: center;
    padding: 12px 20px;
  }

  .topbar .menu-btn {
    font-size: 22px;
    cursor: pointer;
    display: none; 
  }

  .main { flex: 1; display: flex; flex-direction: column; }

  .content { padding: 20px; }

  .pet-card {
    background: var(--pet-card);
    padding: 20px;
    border-radius: 15px;
    display: flex;
    align-items: center;
    gap: 15px;
    max-width: 400px;
    margin-bottom: 20px;
  }

  .pet-card img { width: 70px; height: 70px; }

  .pet-info h3 { margin-bottom: 4px; }

  .section { background: var(--card-bg); padding: 20px; border-radius: 15px; }

  .section h3 { margin-bottom: 15px; }

  .pets { display: flex; gap: 20px; flex-wrap: wrap; }

  .pets .pet { text-align: center; }

  .logo { text-align: center; font-weight: bold; margin-bottom: 20px; font-size: 18px; }
  .logo span { color: red; }

  .pets img { width: 90px; height: 90px; border-radius: 50%; margin-bottom: 8px; object-fit: cover; }

  /* Responsive Sidebar */
  @media (max-width: 768px) {
    body { flex-direction: column; }
    .sidebar {
      position: absolute;
      left: -250px;
      top: 0;
      height: 100%;
      z-index: 1000;
    }
    .sidebar.open { left: 0; }
    .topbar .menu-btn { display: block; } 
    .close-btn {
      display: block;
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--highlight);
      color: #fff;
      font-size: 18px;
      font-weight: bold;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      text-align: center;
      line-height: 28px;
      cursor: pointer;
    }
  }
  @media (min-width: 769px) { .close-btn { display: none; } }
  </style>
  </head>
  <body>

  <div class="sidebar" id="sidebar">
    <div class="close-btn" onclick="toggleSidebar()">√ó</div>
    <div class="logo">FUR<span>FECT</span> MATCH</div>
    <div class="profile-wrapper">
      <img id="profilePic" src="https://cdn-icons-png.flaticon.com/512/847/847969.png" alt="Profile">
      <div class="upload-btn" onclick="document.getElementById('profileInput').click()">+</div>
      <input type="file" id="profileInput" accept="image/*">
    </div>
    <div class="username" id="username">USERNAME</div>
    <div class="menu">
      <a href="dashboard.html" class="active">Dashboard</a>
      <a href="carecenter.html">Care Center</a>
      <a href="adoptioncenter.html">Adoption Center</a>
      <a href="guide.html">Guides</a>
      <a href="#" class="logout-btn" onclick="logout()">üîå Logout</a>
    </div>
  </div>

  <div class="main">
    <div class="topbar">
      <div class="menu-btn" onclick="toggleSidebar()">‚ò∞</div>
    </div>

    <div class="content">
      <div class="pet-card" id="petCard">
  <img id="petCardImage" src="images/Peticon.jpg" alt="Pet Icon">
  <div class="pet-info">
    <h3 id="petCardName">Name of Your Pet</h3>
    <p id="petCardLevel">Level 0</p>
    <button id="editPetNameBtn">‚úèÔ∏è Edit Pet Name</button>
  </div>


  </div>

      </div>

      <div class="section">
        <h3>Newly Adopted Pets</h3>
        <div class="pets" id="adoptedPetsContainer">
          <!-- Adopted pets will be inserted here dynamically -->
        </div>
      </div>
    </div>
  </div>

  <script>
  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('open');
  }

  async function loadUser() {
    const email = localStorage.getItem("userEmail");
    if (!email) return;

    try {
      const res = await fetch(`http://localhost:5000/api/user?email=${email}`);
      const data = await res.json();
      if (data.success) {
        document.getElementById("username").textContent = data.firstName;
        if (data.profileImage) {
          document.getElementById("profilePic").src = data.profileImage;
        }
      }
    } catch (err) { console.error("Error fetching user:", err); }
  }

  document.getElementById("profileInput").addEventListener("change", async function () {
    const file = this.files[0];
    if (!file) return;

    const email = localStorage.getItem("userEmail");
    if (!email) return alert("No email found in localStorage!");

    const formData = new FormData();
    formData.append("profileImage", file);
    formData.append("email", email);

    try {
      const res = await fetch("http://localhost:5000/api/upload-profile", {
        method: "POST",
        body: formData
      });
      const data = await res.json();
      if (data.success) {
        document.getElementById("profilePic").src = data.profileImage;
        alert("Profile picture updated!");
      } else {
        alert("Failed to upload profile picture.");
      }
    } catch (err) { console.error("Upload error:", err); }
  });

  async function loadAdoptedPets() {
    const email = localStorage.getItem("userEmail");
    if (!email) return;
    try {
      const res = await fetch(`http://localhost:5000/api/adoptions/user/adopted?email=${email}`);
      const data = await res.json();
      const petsContainer = document.getElementById("adoptedPetsContainer");
      petsContainer.innerHTML = "";

      if (!data.success || data.pets.length === 0) {
        petsContainer.innerHTML = "<p>No adopted pets yet.</p>";
        return;
      }

      data.pets.forEach(pet => {
        const petDiv = document.createElement("div");
        petDiv.classList.add("pet");
        const petImgSrc = pet.petImage || "/images/pet.jpg";

        petDiv.innerHTML = `
          <img src="${petImgSrc}" alt="${pet.petName}">
          <p><strong>${pet.petName}</strong> (${pet.petBreed})</p>
          <p>Adopted on: ${new Date(pet.requestDate).toLocaleDateString()}</p>
        `;
        petsContainer.appendChild(petDiv);
      });
    } catch (err) { console.error("Error fetching adopted pets:", err); }
  }
async function loadPetData() {
  const email = localStorage.getItem("userEmail");
  if (!email) return;

  try {
    const res = await fetch(`http://localhost:5000/api/get-pet?email=${email}`);
    const data = await res.json();

    if (!data.success || !data.pet) return;

    const petData = data.pet;
    localStorage.setItem("petData", JSON.stringify(petData));

    // determine correct image by level + type
    updatePetImageByLevel(petData);

    document.getElementById("petCardName").textContent = petData.name || "My Pet";
    document.getElementById("petCardLevel").textContent = "Level " + (petData.level || 0);

    // edit name button
    document.getElementById("editPetNameBtn").onclick = async function () {
      const newName = prompt("Enter your pet's name:", petData.name || "My Pet");
      if (newName && newName.trim() !== "") {
        petData.name = newName.trim();
        document.getElementById("petCardName").textContent = newName;
        localStorage.setItem("petData", JSON.stringify(petData));

        // save to backend
        await fetch("http://localhost:5000/api/save-pet", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, pet: petData })
        });
      }
    };
  } catch (err) {
    console.error("Error fetching pet data:", err);
  }
}

function updatePetImageByLevel(petData) {
  let petType = petData.type || "cat"; // fallback
  let level = petData.level || 1;
  let imagePath = "images/Peticon.jpg";

  if (petType === "cat") {
    if (level <= 10) imagePath = "images/cat_baby.png";
    else if (level <= 20) imagePath = "images/cat_grow.png";
    else imagePath = "images/cat_adult.png";
  } else if (petType === "dog") {
    if (level <= 10) imagePath = "images/dog_baby.png";
    else if (level <= 20) imagePath = "images/dog_grow.png";
    else imagePath = "images/dog_adult.png";
  }

  document.getElementById("petCardImage").src = imagePath;
}


  window.onload = () => {
    loadUser();
    loadAdoptedPets();
    loadPetData();
  };

  function logout() {
    // Optional: Save pet data to backend before logging out
    const petData = JSON.parse(localStorage.getItem("petData"));
    const email = localStorage.getItem("userEmail");
    if (petData && email) {
      fetch("http://localhost:5000/api/save-pet", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, pet: petData })
      }).then(res => res.json())
        .then(data => console.log("Pet saved on logout:", data))
        .catch(console.error);
    }

    // Clear all localStorage for safety
    localStorage.removeItem("userEmail");
    localStorage.removeItem("petData");
    localStorage.removeItem("petName"); // if you used this key

    // Redirect to login page
    window.location.href = "login.html";
  }

  </script>

  </body>
  </html>
